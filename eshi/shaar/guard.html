<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>×©×¢×¨ ×‘×™×ª ×”×¡×¤×¨ â€” ××¡×š ×©×•××¨</title>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700;800&family=Secular+One&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0e1a; --card: rgba(22,28,45,0.7); --card-h: rgba(30,38,60,0.8);
      --blue: #00d4ff; --purple: #b44dff; --pink: #ff6bb5; --green: #00e676; --orange: #ffab40;
      --t1: #eef2ff; --t2: #8892b0; --t3: #4a5578; --border: rgba(136,146,176,0.08);
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Rubik',sans-serif; background:var(--bg); color:var(--t1); min-height:100vh; direction:rtl; overflow-x:hidden; }
    body::before { content:''; position:fixed; top:-40%; left:-20%; width:70vw; height:70vw; border-radius:50%; background:radial-gradient(circle,rgba(0,230,118,0.1) 0%,transparent 60%); animation:bgF 22s ease-in-out infinite; pointer-events:none; }
    body::after { content:''; position:fixed; bottom:-50%; right:-25%; width:80vw; height:80vw; border-radius:50%; background:radial-gradient(circle,rgba(180,77,255,0.08) 0%,transparent 60%); animation:bgF 28s ease-in-out infinite reverse; pointer-events:none; }
    @keyframes bgF { 0%,100%{transform:translate(0,0) scale(1)} 33%{transform:translate(4%,6%) scale(1.04)} 66%{transform:translate(-3%,-4%) scale(0.96)} }

    .header { background:rgba(10,14,26,0.85); backdrop-filter:blur(20px); border-bottom:1px solid var(--border); padding:14px 20px; display:flex; align-items:center; justify-content:space-between; position:sticky; top:0; z-index:100; }
    .header-logo { display:flex; align-items:center; gap:12px; }
    .logo-icon { width:42px; height:42px; border-radius:12px; background:linear-gradient(135deg,var(--green),var(--blue)); display:flex; align-items:center; justify-content:center; font-size:20px; box-shadow:0 4px 20px rgba(0,230,118,0.25); }
    .header h1 { font-family:'Secular One',sans-serif; font-size:17px; background:linear-gradient(135deg,var(--green),var(--blue)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
    .header p { color:var(--t3); font-size:11px; }
    .header-controls { display:flex; align-items:center; gap:16px; }
    .connection { display:flex; align-items:center; gap:6px; font-size:11px; color:var(--t3); }
    .connection-dot { width:7px; height:7px; border-radius:50%; background:var(--t3); transition:all .3s; }
    .connection-dot.online { background:var(--green); box-shadow:0 0 10px rgba(0,230,118,0.6); }

    .pending-counter { border-radius:12px; padding:8px 16px; display:flex; align-items:center; gap:8px; transition:all .3s; }
    .pending-counter.active { background:rgba(0,230,118,0.08); border:1px solid rgba(0,230,118,0.15); }
    .pending-counter.inactive { background:rgba(136,146,176,0.04); border:1px solid var(--border); }
    .pending-dot { width:8px; height:8px; border-radius:50%; transition:all .3s; }
    .pending-dot.active { background:var(--green); box-shadow:0 0 12px rgba(0,230,118,0.5); animation:pulse 2s infinite; }
    .pending-dot.inactive { background:var(--t3); }
    .pending-text { font-size:13px; font-weight:600; }
    .pending-text.active { color:var(--green); }
    .pending-text.inactive { color:var(--t3); }

    .content { max-width:620px; margin:0 auto; padding:24px 16px 80px; position:relative; z-index:1; }
    .search-input { width:100%; padding:14px 18px; border-radius:14px; border:1.5px solid var(--border); background:var(--card); color:var(--t1); font-size:15px; font-family:'Rubik',sans-serif; margin-bottom:24px; outline:none; direction:rtl; backdrop-filter:blur(8px); }
    .search-input:focus { border-color:rgba(0,230,118,0.25); }
    .search-input::placeholder { color:var(--t3); }

    .section-label { font-size:12px; font-weight:600; margin-bottom:12px; letter-spacing:1px; text-transform:uppercase; }
    .section-label.green { color:var(--green); }
    .section-label.muted { color:var(--t3); }

    .release-card { padding:18px 20px; border-radius:16px; background:linear-gradient(135deg,rgba(0,230,118,0.05),var(--card)); border:1.5px solid rgba(0,230,118,0.12); display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; animation:slideIn .4s ease; backdrop-filter:blur(8px); }
    .release-info { display:flex; align-items:center; gap:14px; }
    .release-avatar { width:48px; height:48px; border-radius:50%; background:linear-gradient(135deg,var(--green),#00b86e); display:flex; align-items:center; justify-content:center; font-size:20px; color:#fff; font-weight:700; box-shadow:0 4px 20px rgba(0,230,118,0.3); flex-shrink:0; }
    .release-name { font-size:17px; font-weight:700; }
    .release-details { color:var(--t2); font-size:13px; margin-top:2px; }
    .release-time { color:var(--t3); font-size:11px; margin-top:2px; }
    .exit-btn { background:linear-gradient(135deg,var(--green),#00b86e); border:none; border-radius:12px; padding:12px 22px; color:#fff; cursor:pointer; font-size:14px; font-weight:700; font-family:'Rubik',sans-serif; box-shadow:0 4px 20px rgba(0,230,118,0.3); transition:all .2s; white-space:nowrap; flex-shrink:0; }
    .exit-btn:hover { transform:translateY(-2px); box-shadow:0 8px 28px rgba(0,230,118,0.4); }

    .exited-item { padding:12px 16px; border-radius:12px; background:rgba(22,28,45,0.4); border:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; opacity:.55; margin-bottom:6px; }
    .exited-info { display:flex; align-items:center; gap:8px; }
    .empty-state { text-align:center; padding:48px 20px; background:rgba(22,28,45,0.3); border-radius:16px; border:1px solid var(--border); margin-bottom:28px; }
    .empty-state .icon { font-size:40px; opacity:.4; margin-bottom:12px; }
    .empty-state p { color:var(--t3); font-size:14px; }

    .toast { position:fixed; top:20px; left:50%; transform:translateX(-50%); border-radius:14px; padding:12px 28px; font-size:14px; font-weight:600; font-family:'Rubik',sans-serif; z-index:9999; backdrop-filter:blur(16px); animation:ti .35s cubic-bezier(.16,1,.3,1); pointer-events:none; }
    .toast-info { background:rgba(0,212,255,0.15); border:1px solid rgba(0,212,255,0.3); color:var(--blue); }
    .toast-success { background:rgba(0,230,118,0.15); border:1px solid rgba(0,230,118,0.3); color:var(--green); }

    .credit { position:fixed; bottom:0; left:0; right:0; text-align:center; padding:10px; background:rgba(10,14,26,0.9); backdrop-filter:blur(12px); border-top:1px solid var(--border); font-size:11px; color:var(--t3); z-index:100; }
    .credit span { background:linear-gradient(135deg,var(--green),var(--blue)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; font-weight:600; }

    .hidden { display:none; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }
    @keyframes slideIn { from{opacity:0;transform:translateX(20px)} to{opacity:1;transform:translateX(0)} }
    @keyframes ti { from{opacity:0;transform:translateX(-50%) translateY(-16px)} to{opacity:1;transform:translateX(-50%) translateY(0)} }
  </style>
</head>
<body>
  <div id="toast" class="toast hidden"></div>
  <div class="header">
    <div class="header-logo"><div class="logo-icon">ğŸ›¡ï¸</div><div><h1>×©×¢×¨ ×‘×™×ª ×”×¡×¤×¨</h1><p>××¡×š ×©×•××¨</p></div></div>
    <div class="header-controls">
      <div class="connection"><div id="connectionDot" class="connection-dot"></div><span id="connectionText">××ª×—×‘×¨...</span></div>
      <div class="pending-counter inactive" id="pendingCounter"><div class="pending-dot inactive" id="pendingDot"></div><span class="pending-text inactive" id="pendingText">0 ×××ª×™× ×™×</span></div>
    </div>
  </div>
  <div class="content">
    <input type="text" class="search-input" placeholder="ğŸ” ×—×™×¤×•×© ×ª×œ××™×“..." id="guardSearch" oninput="renderGuard()">
    <div class="section-label green">×××•×©×¨×™× ×œ×™×¦×™××”</div>
    <div id="pendingList"></div>
    <div id="exitedSection" class="hidden">
      <div class="section-label muted" id="exitedLabel">×™×¦××• ×”×™×•×</div>
      <div id="exitedList"></div>
    </div>
  </div>
  <div class="credit">×¤×™×ª×•×— ×”××¤×œ×™×§×¦×™×” â€” <span>×¨× ×™ ×‘×Ÿ ×–××‘</span></div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig={apiKey:"AIzaSyCSmwys1pNEEMu8oq4r_Q6sMtHEiba33pw",authDomain:"gmarlamed.firebaseapp.com",databaseURL:"https://gmarlamed-default-rtdb.firebaseio.com",projectId:"gmarlamed",storageBucket:"gmarlamed.firebasestorage.app",messagingSenderId:"287104553740",appId:"1:287104553740:web:ab36b987cf86f913c76f29"};
    firebase.initializeApp(firebaseConfig);
    const db=firebase.database(),releasesRef=db.ref('releases');
    let releases={},previousPendingCount=0;

    db.ref('.info/connected').on('value',s=>{const d=document.getElementById('connectionDot'),t=document.getElementById('connectionText');if(s.val()===true){d.classList.add('online');t.textContent='××—×•×‘×¨ â€” ×–××Ÿ ×××ª';}else{d.classList.remove('online');t.textContent='×œ× ××—×•×‘×¨';}});

    releasesRef.on('value',s=>{releases=s.val()||{};const pc=getPending().length;if(pc>previousPendingCount&&previousPendingCount>=0){playAlert();const n=getPending()[0];if(n)showToast(`ğŸ”” ×©×—×¨×•×¨ ×—×“×©: ${n[1].studentName}`,'success');}previousPendingCount=pc;renderGuard();});

    function getToday(){return new Date().toDateString();}
    function getPending(){return Object.entries(releases).filter(([_,r])=>r.status==='pending'&&new Date(r.time).toDateString()===getToday()).sort((a,b)=>new Date(b[1].time)-new Date(a[1].time));}
    function getExited(){return Object.entries(releases).filter(([_,r])=>r.status==='exited'&&new Date(r.time).toDateString()===getToday()).sort((a,b)=>new Date(b[1].exitTime||b[1].time)-new Date(a[1].exitTime||a[1].time));}

    function renderGuard(){
      const search=document.getElementById('guardSearch').value;
      const pending=getPending().filter(([_,r])=>r.studentName.includes(search)||r.className.includes(search));
      const exited=getExited();
      const allP=getPending();
      const counter=document.getElementById('pendingCounter'),dot=document.getElementById('pendingDot'),text=document.getElementById('pendingText');
      if(allP.length>0){counter.className='pending-counter active';dot.className='pending-dot active';text.className='pending-text active';text.textContent=`${allP.length} ×××ª×™× ×™×`;}
      else{counter.className='pending-counter inactive';dot.className='pending-dot inactive';text.className='pending-text inactive';text.textContent='0 ×××ª×™× ×™×';}

      const pl=document.getElementById('pendingList');
      if(pending.length===0){pl.innerHTML='<div class="empty-state"><div class="icon">âœ…</div><p>××™×Ÿ ×ª×œ××™×“×™× ×”×××ª×™× ×™× ×œ×™×¦×™××”</p></div>';}
      else{pl.innerHTML=pending.map(([id,r])=>`<div class="release-card"><div class="release-info"><div class="release-avatar">${r.studentName[0]}</div><div><div class="release-name">${r.studentName}</div><div class="release-details">×›×™×ª×” ${r.className} Â· ${r.reason}</div><div class="release-time">×©×•×—×¨×¨ ×‘-${formatTime(r.time)}</div></div></div><button class="exit-btn" onclick="markExited('${id}')">××™×©×•×¨ ×™×¦×™××” âœ“</button></div>`).join('');}

      const es=document.getElementById('exitedSection');
      if(exited.length>0){es.classList.remove('hidden');document.getElementById('exitedLabel').textContent=`×™×¦××• ×”×™×•× (${exited.length})`;document.getElementById('exitedList').innerHTML=exited.map(([id,r])=>`<div class="exited-item"><div class="exited-info"><span style="color:var(--t3);font-size:14px">âœ“</span><span style="color:var(--t2);font-size:14px">${r.studentName}</span><span style="color:var(--t3);font-size:12px">×›×™×ª×” ${r.className}</span></div><span style="color:var(--t3);font-size:12px">×™×¦×/×” ×‘-${r.exitTime?formatTime(r.exitTime):'â€”'}</span></div>`).join('');}
      else{es.classList.add('hidden');}
    }

    function markExited(id){const s=releases[id];releasesRef.child(id).update({status:'exited',exitTime:new Date().toISOString()}).then(()=>{if(s)showToast(`${s.studentName} ×™×¦×/×” ××”×©×¢×¨`,'info');});}

    function playAlert(){
      try{const c=new(window.AudioContext||window.webkitAudioContext)(),o=c.createOscillator(),g=c.createGain();o.connect(g);g.connect(c.destination);o.frequency.value=800;o.type='sine';g.gain.setValueAtTime(.3,c.currentTime);g.gain.exponentialRampToValueAtTime(.01,c.currentTime+.5);o.start(c.currentTime);o.stop(c.currentTime+.5);setTimeout(()=>{const o2=c.createOscillator(),g2=c.createGain();o2.connect(g2);g2.connect(c.destination);o2.frequency.value=1000;o2.type='sine';g2.gain.setValueAtTime(.3,c.currentTime);g2.gain.exponentialRampToValueAtTime(.01,c.currentTime+.3);o2.start(c.currentTime);o2.stop(c.currentTime+.3);},200);}catch(e){}
      document.body.style.transition='background .3s';document.body.style.background='linear-gradient(160deg,#0a1a10 0%,#102e14 50%,#0a1a10 100%)';setTimeout(()=>{document.body.style.background='var(--bg)';},600);
    }

    function formatTime(i){return new Date(i).toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'});}
    function showToast(m,t){const e=document.getElementById('toast');e.className=`toast toast-${t}`;e.textContent=m;e.classList.remove('hidden');setTimeout(()=>e.classList.add('hidden'),3500);}
    renderGuard();
  </script>
</body>
</html>
