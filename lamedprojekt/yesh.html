<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>טופס רעיון לפרויקט למ"ד</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e3a8a;
            --accent-color: #facc15;
            --bg-color: #f0f2f5;
            --text-color: #333;
            --drive-color: #FFD04B;
            --drive-text: #333;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Heebo', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            padding-bottom: 160px;
        }

        /* --- כותרת --- */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)) !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
            color: white;
            padding: 30px 20px 50px 20px;
            text-align: center;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            margin-bottom: -30px;
        }

        header h1 { margin: 0; font-size: 1.8rem; font-weight: 800; }
        header .subtitle { 
            background: rgba(255,255,255,0.2); 
            color: var(--accent-color); 
            font-weight: bold;
            padding: 4px 10px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 5px;
            font-size: 0.9rem;
        }
        
        header p { margin: 10px 0 20px; opacity: 0.9; font-size: 0.9rem; }

        .personal-details {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(5px);
            padding: 15px;
            border-radius: 16px;
            text-align: right;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .input-row { margin-bottom: 10px; }
        .input-row:last-child { margin-bottom: 0; }
        
        .input-row label {
            display: block;
            font-size: 0.85rem;
            color: rgba(255,255,255,0.9);
            margin-bottom: 2px;
        }

        /* שדות קלט בכותרת */
        .header-input {
            width: 100%;
            background: rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            text-align: right;
        }
        .header-input::placeholder { color: rgba(255,255,255,0.5); }
        
        /* --- כרטיסים --- */
        .container { padding: 0 15px; max-width: 800px; margin: 0 auto; }

        .card {
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.05);
            page-break-inside: avoid;
            background-color: white;
            -webkit-print-color-adjust: exact;
        }

        /* צבעים */
        .card:nth-of-type(1) { background-color: #eaf6fc !important; border-color: #d6eaf8; }
        .card:nth-of-type(1) .icon { color: #2980b9; }
        .card:nth-of-type(1) .card-title { color: #1a5276; }

        .card:nth-of-type(2) { background-color: #f4eff8 !important; border-color: #e8daef; }
        .card:nth-of-type(2) .icon { color: #8e44ad; }
        .card:nth-of-type(2) .card-title { color: #5b2c6f; }

        .card:nth-of-type(3) { background-color: #ebf7f2 !important; border-color: #d5f5e3; }
        .card:nth-of-type(3) .icon { color: #27ae60; }
        .card:nth-of-type(3) .card-title { color: #145a32; }

        .card:nth-of-type(4) { background-color: #fff8ec !important; border-color: #fae5d3; }
        .card:nth-of-type(4) .icon { color: #d35400; }
        .card:nth-of-type(4) .card-title { color: #873600; }

        .card:nth-of-type(5) { background-color: #fffae6 !important; border-color: #f9e79f; }
        .card:nth-of-type(5) .icon { color: #f39c12; }
        .card:nth-of-type(5) .card-title { color: #7d6608; }

        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .card-title { font-size: 1.2rem; font-weight: 800; margin: 0; }
        .icon { font-size: 26px; }

        .example-box {
            background: rgba(255,255,255,0.6);
            border-right: 4px solid rgba(0,0,0,0.1);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .example-title { font-weight: bold; color: var(--text-color); display: block; margin-bottom: 4px; }
        .example-text { color: #555; line-height: 1.4; font-size: 0.85rem; }

        /* שדות קלט רגילים */
        textarea, input[type="text"].content-input {
            width: 100%;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 12px;
            padding: 12px;
            font-size: 16px;
            font-family: 'Heebo', sans-serif;
            background: #fff;
            transition: all 0.3s;
            -webkit-appearance: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
            text-align: right; 
            direction: rtl;
        }

        textarea { resize: vertical; min-height: 100px; line-height: 1.5; }

        /* --- דיב חלופי להדפסה (הפתרון לבעיות) --- */
        .print-replacement {
            display: none; /* מוסתר בשימוש רגיל */
            white-space: pre-wrap; /* שומר על ירידות שורה */
            width: 100%;
            padding: 10px;
            
            /* שינוי קריטי: שימוש בפונט אריאל בזמן הדפסה לפתרון בעיות רווחים */
            font-family: 'Arial', sans-serif !important; 
            
            font-size: 16px;
            text-align: right;
            direction: rtl;
            line-height: 1.6;
        }

        .header-replacement {
            color: white;
            background: rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            padding: 8px;
        }

        .content-replacement {
            color: #333;
            background: #fff;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 12px;
        }

        /* מצב יצירת PDF: הסתרת אינפוטים והצגת הדיבים החלופיים */
        body.generating-pdf input, 
        body.generating-pdf textarea {
            display: none !important;
        }

        body.generating-pdf .print-replacement {
            display: block !important;
        }

        /* --- כפתורים צפים --- */
        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 15px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            padding-bottom: max(15px, env(safe-area-inset-bottom));
        }

        .btn {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: none;
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn-pdf { 
            background-color: var(--primary-color); 
            color: white;
        }

        .btn-drive {
            background-color: var(--drive-color);
            color: var(--drive-text);
        }
        
        .btn-loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .btn:active { transform: scale(0.96); }

    </style>
</head>
<body>

    <div id="contentToPrint">
        <header>
            <span class="subtitle">המורה, יש לי רעיון!</span>
            <h1>טופס רעיון לפרויקט למ"ד</h1>
            <p>יש להגיש לאישור הפיקוח עד סוף חודש ינואר</p>
            
            <div class="personal-details">
                <div class="input-row">
                    <label>שם התלמיד/ה:</label>
                    <input type="text" id="studentName" class="header-input">
                    <div class="print-replacement header-replacement"></div>
                </div>
                <div class="input-row">
                    <label>בית ספר:</label>
                    <input type="text" id="schoolName" class="header-input">
                    <div class="print-replacement header-replacement"></div>
                </div>
                <div class="input-row">
                    <label>שם המורה המנחה:</label>
                    <input type="text" id="teacherName" class="header-input">
                    <div class="print-replacement header-replacement"></div>
                </div>
            </div>
        </header>

        <div class="container" style="margin-top: 20px;">

            <div class="card">
                <div class="card-header">
                    <span class="material-icons-round icon">lightbulb</span>
                    <h3 class="card-title">1. נושא ושאלת החקר</h3>
                </div>
                <div class="example-box">
                    <span class="example-title">נושא העבודה</span>
                    <div class="example-text">דוגמה: ייצוג ספורט נשים בתקשורת</div>
                </div>
                <input type="text" id="topic" class="content-input" placeholder="כתבו כאן את נושא העבודה...">
                <div class="print-replacement content-replacement"></div>

                <div class="example-box" style="margin-top: 15px;">
                    <span class="example-title">השאלה המרכזית</span>
                    <div class="example-text">דוגמה: כיצד מיוצג ספורט הנשים בערוץ הספורט?</div>
                </div>
                <input type="text" id="mainQuestion" class="content-input" placeholder="כתבו כאן את שאלת החקר...">
                <div class="print-replacement content-replacement"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="material-icons-round icon">menu_book</span>
                    <h3 class="card-title">2. חלק תיאורטי</h3>
                </div>
                <div class="example-box">
                    <span class="example-title">4 מושגים מתוכנית הלימודים</span>
                    <div class="example-text">
                        דוגמאות: סטריאוטיפים, שוויון מגדרי, הכחדה סימבולית, דנוטציה/קונוטציה.
                    </div>
                </div>
                <textarea id="concepts" placeholder="פרטו כאן את 4 המושגים..."></textarea>
                <div class="print-replacement content-replacement"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="material-icons-round icon">travel_explore</span>
                    <h3 class="card-title">3. שדה מחקר</h3>
                </div>
                <div class="example-box">
                    <span class="example-title">מה הטקסטים שאני מתכוון לבדוק?</span>
                    <div class="example-text">
                        לדוגמה: 12 מהדורות חדשות הספורט אקראיות מהשנה האחרונה.
                    </div>
                </div>
                <textarea id="researchField" placeholder="כתבו כאן את שדה המחקר..."></textarea>
                <div class="print-replacement content-replacement"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="material-icons-round icon">manage_search</span>
                    <h3 class="card-title">4. שיטת מחקר (שאלות מסרק)</h3>
                </div>
                <div class="example-box">
                    <span class="example-title">כיצד אבחן את הטקסטים?</span>
                    <div class="example-text">
                        לפחות 5 שאלות שנובעות מהשאלה הכללית.
                    </div>
                </div>
                <textarea id="researchMethod" rows="6" placeholder="1.
2.
3.
4.
5."></textarea>
                <div class="print-replacement content-replacement"></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="material-icons-round icon">draw</span>
                    <h3 class="card-title">אישורים</h3>
                </div>
                <div style="font-size: 0.9rem; color: #666;">
                    <p style="border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 10px; margin-bottom: 10px;">חתימת המורה: ___________________</p>
                    <p style="border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 10px; margin-bottom: 10px;">הערות הפיקוח: ___________________</p>
                    <p>חתימת הפיקוח: ___________________</p>
                </div>
            </div>

        </div>
    </div>

    <div class="bottom-bar" data-html2canvas-ignore="true">
        <button class="btn btn-pdf" onclick="savePDF()" id="pdfBtn">
            <span class="material-icons-round">picture_as_pdf</span>
            שלב 1: שמירת קובץ PDF
        </button>

        <button class="btn btn-drive" onclick="openDriveLink()">
            <span class="material-icons-round">add_to_drive</span>
            שלב 2: העלאה לדרייב הכיתתי
        </button>
    </div>

    <script>
        const YOUR_DRIVE_LINK = "https://drive.google.com/drive/folders/1n60LUddq6IQymUMVysXk2h80KUgz6Kp1?usp=sharing"; 

        // שמירה אוטומטית
        const fields = ['studentName', 'schoolName', 'teacherName', 'topic', 'mainQuestion', 'concepts', 'researchField', 'researchMethod'];
        window.onload = () => { fields.forEach(id => { const val = localStorage.getItem(id); if(val) document.getElementById(id).value = val; }); };
        fields.forEach(id => { const el = document.getElementById(id); if(el) el.addEventListener('input', function() { localStorage.setItem(id, this.value); }); });

        function openDriveLink() {
            window.open(YOUR_DRIVE_LINK, '_blank');
        }

        async function savePDF() {
            const btn = document.getElementById('pdfBtn');
            const originalText = btn.innerHTML;
            const studentName = document.getElementById('studentName').value || 'תלמיד';
            
            window.scrollTo(0,0);
            btn.innerHTML = '<span class="material-icons-round">hourglass_empty</span> מעבד נתונים...';
            btn.classList.add('btn-loading');

            // --- הפעולה הקריטית: העברת טקסט ל-Divs והסתרת ה-Inputs ---
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                const replacement = input.nextElementSibling;
                if (replacement && replacement.classList.contains('print-replacement')) {
                    // קבלת הערך
                    let val = input.value || " ";
                    
                    // *** התיקון למילים מחוברות ***
                    // החלפת כל רווח רגיל (Space) בתו מיוחד שנקרא Non-Breaking Space.
                    // זה מכריח את המחשב להציג רווח ולא לצמצם אותו.
                    val = val.replace(/ /g, '\u00A0');
                    
                    replacement.innerText = val;
                }
            });

            // הפעלת מצב הדפסה (CSS יסתיר אינפוטים ויציג דיבים עם פונט אריאל)
            document.body.classList.add('generating-pdf');

            const element = document.getElementById('contentToPrint');
            const opt = {
                margin: 0,
                filename: `הצעת_חקר_${studentName}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2, 
                    useCORS: true, 
                    scrollY: 0,
                    letterRendering: true 
                },
                jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
            };

            try {
                // המתן מעט כדי שהשינויים ב-DOM יחולו
                await new Promise(r => setTimeout(r, 200));
                
                await html2pdf().set(opt).from(element).save();
                
                setTimeout(() => {
                    alert('✅ הקובץ נשמר!\n\nכעת לחץ על כפתור "שלב 2" כדי להעלות אותו לדרייב.');
                }, 1000);
            } catch (err) {
                console.error('Error:', err);
                alert('אירעה שגיאה. נסה שוב.');
            } finally {
                // החזרת המצב לקדמותו
                document.body.classList.remove('generating-pdf');
                btn.innerHTML = originalText;
                btn.classList.remove('btn-loading');
            }
        }
    </script>

</body>
</html>